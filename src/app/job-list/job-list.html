<h1 class="fw-bold my-3 text-center">Find Jobs</h1>

<div class="container-fluid mb-4">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <div class="row g-2 align-items-center search-bar-wrapper">
        <div class="col-md-4">
          <div class="input-icon-container">
            <i class="fas fa-search input-icon"></i> 
            <input type="text" class="form-control" name="job-title" id="job-title" placeholder="Search for Title" [(ngModel)]="jobTitleSearch">
          </div>
        </div>
        <div class="col-md-4">
          <div class="input-icon-container">
            <i class="fas fa-location-dot input-icon"></i> 
            <input type="text" class="form-control" name="job-location" id="job-location" placeholder="Location (e.g, Manila)" [(ngModel)]="jobLocationSearch">
          </div>
        </div>
        <div class="col-md-2">
          <div class="input-icon-container">
            <i class="fas fa-filter input-icon"></i> 
            <i class="fas fa-chevron-down dropdown-arrow"></i> 
            <select class="form-control" name="job-type" id="job-type" [(ngModel)]="jobTypeSearch">
              @for (type of jobTypes; track type.value) {
                <option [value]="type.value">{{ type.label }}</option>
              }
            </select>
          </div>
        </div>
        
        <div class="col-md-2 d-flex gap-2 justify-content-end">
          <button class="btn btn-primary" (click)="searchJob()">Search</button>
          <button class="btn btn-danger" (click)="resetFilters()">Reset</button>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid">
  <div class="row mx-5 my-4">
    @if (loading) {
      <div class="col-12 text-center py-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-3 text-muted">Finding the best jobs for you...</p>
      </div>
    } @else {
      <div class="col-4">
        <div class="job-list">
          @for (job of jobs; track job.id) {
            <div class="job-item" [class.active]="jobDetails?.id === job.id" (click)="viewJob(job.id)">
              <div class="d-flex justify-content-between align-items-start">
                <div>
                  <h2 class="fs-5 mb-1">{{ job.title }}</h2>
                  <p class="text-muted mb-1">{{ job.location }} | {{ job.type }}</p>
                  <p class="text-success fw-bold mb-0">{{ job.salary }}</p>
                </div>
                @if (canSaveJobs()) {
                  <button 
                    class="btn btn-sm save-btn"
                    [class.saved]="isJobSaved(job.id)"
                    (click)="toggleSaveJob(job.id, $event)"
                    [title]="isJobSaved(job.id) ? 'Remove from saved' : 'Save job'"
                  >
                    {{ isJobSaved(job.id) ? '★' : '☆' }}
                  </button>
                }
              </div>
            </div>
          }
        </div>
      </div>
      
      <div class="col">
        @if (jobDetails) {
          <div class="job-details-card">
            <h2 class="fs-2 fw-bold">{{ jobDetails.title }}</h2>
            <h3 class="fs-5 text-muted">{{ jobDetails.company }}</h3>
            <div class="job-meta my-3">
              <span class="badge badge-meta me-2">{{ jobDetails.location }}</span>
              <span class="badge badge-meta me-2">{{ jobDetails.type }}</span>
              <span class="badge bg-success">{{ jobDetails.salary }}</span>
            </div>
            <p class="mt-4">{{ jobDetails.description }}</p>
            <div class="d-flex gap-2 mt-4">
              <button class="btn btn-primary" (click)="applyToJob(jobDetails.id, $event)">Apply</button>
              @if (canSaveJobs()) {
                <button 
                  class="btn"
                  [class.btn-outline-danger]="isJobSaved(jobDetails.id)" 
                  [class.btn-outline-primary]="!isJobSaved(jobDetails.id)"
                  (click)="toggleSaveJob(jobDetails.id, $event)"
                >
                  {{ isJobSaved(jobDetails.id) ? 'Unsave Job' : 'Save Job' }}
                </button>
              }
            </div>
          </div>
        } @else {
          <div class="empty-details text-center py-5">
            <i class="fas fa-search empty-details-icon"></i>
            <p class="text-muted">Select a job to view details</p>
          </div>
        }
      </div>
    }
  </div>
</div>

@if (showApplicationModal && jobDetails) {
  <div class="modal-overlay">
    <div class="modal-content">
      @if (!showConfirmation) {
        <h2>Apply for {{ jobDetails.title }}</h2>
        <p class="text-muted mb-4">Please answer the following questions to complete your application.</p>

        <form>
          @for (response of applicationResponses; track $index) {
            <div class="form-group mb-3">
              <label class="form-label fw-bold question-text">
                {{ response.question }}
                @if (applicationQuestions[$index].required) {
                  <span class="text-danger">*</span>
                }
              </label>
              <textarea
                class="form-control"
                rows="4"
                [(ngModel)]="response.answer"
                [name]="'response-' + $index"
                [disabled]="isSubmitting"
                placeholder="Enter your answer here..."
              ></textarea>
            </div>
          }
        </form>

        <div class="modal-footer mt-4 d-flex justify-content-end align-items-center gap-2">
          <button
            class="btn btn-secondary btn-cancel-modal"
            (click)="closeApplicationModal()"
            [disabled]="isSubmitting"
          >
            Cancel
          </button>
          <button
            class="btn btn-primary"
            (click)="submitApplication()"
            [disabled]="isSubmitting"
          >
            {{ isSubmitting ? 'Submitting...' : 'Submit Application' }}
          </button>
        </div>
      } @else {
        <div class="confirmation-content text-center py-4">
          <i class="fas fa-check-circle confirmation-icon text-success mb-3"></i>
          <h2>Application Submitted!</h2>
          <p class="text-muted mb-4">
            Your application for <strong>{{ jobDetails.title }}</strong> has been successfully submitted.
            The employer will review your application and get back to you soon.
          </p>
          <button class="btn btn-primary" (click)="closeApplicationModal()">
            Done
          </button>
        </div>
      }
    </div>
  </div>
}